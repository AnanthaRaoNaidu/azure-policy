{
  "id": "/providers/Microsoft.Authorization/policyDefinitions/201ea587-7c90-41c3-910f-c280ae01cfd6",
  "name": "201ea587-7c90-41c3-910f-c280ae01cfd6",
  "properties": {
    "policyType": "BuiltIn",
    "metadata": {
      "version": "1.0.0",
      "category": "Security Center"
    },
    "parameters": {
      "effect": {
        "type": "string",
        "allowedValues": [
          "AuditIfNotExists",
          "Disabled"
        ],
        "metadata": {
          "description": "Enable or disable the execution of the policy",
          "displayName": "Effect"
        },
        "defaultValue": "AuditIfNotExists"
      }
    },
    "displayName": "Web ports should be restricted on Network Security Groups associated to your VM",
    "policyRule": {
      "then": {
        "details": {
          "existenceCondition": {
            "field": "Microsoft.Security/complianceResults/resourceStatus",
            "in": [
              "OffByPolicy",
              "Healthy"
            ]
          },
          "type": "Microsoft.Security/complianceResults",
          "name": "unprotectedWebApplication"
        },
        "effect": "[parameters('effect')]"
      },
      "if": {
        "field": "type",
        "in": [
          "Microsoft.Compute/virtualMachines",
          "Microsoft.ClassicCompute/virtualMachines"
        ]
      }
    },
    "description": "Azure security center has discovered that some of your virtual machines are running web applications, and the NSGs associated to these virtual machines are overly permissive with regards to the web application ports",
    "mode": "All"
  }
}
