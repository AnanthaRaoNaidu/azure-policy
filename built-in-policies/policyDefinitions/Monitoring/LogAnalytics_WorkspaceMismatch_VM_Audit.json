{
  "id": "/providers/Microsoft.Authorization/policyDefinitions/f47b5582-33ec-4c5c-87c0-b010a6b2e917",
  "name": "f47b5582-33ec-4c5c-87c0-b010a6b2e917",
  "properties": {
    "policyType": "BuiltIn",
    "metadata": {
      "version": "1.0.0",
      "category": "Monitoring"
    },
    "parameters": {
      "logAnalyticsWorkspaceId": {
        "type": "String",
        "metadata": {
          "description": "This is the Id (GUID) of the Log Analytics Workspace that the VMs should be configured for.",
          "displayName": "Log Analytics Workspace Id that VMs should be configured for"
        }
      }
    },
    "displayName": "[Preview]: Audit Log Analytics Workspace for VM - Report Mismatch",
    "policyRule": {
      "then": {
        "effect": "audit"
      },
      "if": {
        "allOf": [
          {
            "field": "type",
            "equals": "Microsoft.Compute/virtualMachines/extensions"
          },
          {
            "field": "Microsoft.Compute/virtualMachines/extensions/publisher",
            "equals": "Microsoft.EnterpriseCloud.Monitoring"
          },
          {
            "field": "Microsoft.Compute/virtualMachines/extensions/settings.workspaceId",
            "notEquals": "[parameters('logAnalyticsWorkspaceId')]"
          }
        ]
      }
    },
    "description": "Reports VMs as non-compliant if they not logging to the LA workspace specified in the policy/initiative assignment.",
    "mode": "Indexed"
  }
}
