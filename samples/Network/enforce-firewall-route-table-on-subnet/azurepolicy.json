{
	"type": "Microsoft.Authorization/policyDefinitions",
	"name": "enforce-firewallroutetable-on-subnet",
	"properties": {
		"displayName": "Route table of every subnet",
		"description": "This policy enforces a specific Route Table on every subnet",
		"parameters": {
			"rtId": {
				"type": "String",
				"metadata": {
					"description": "Resource Id of the Firewall route table",
					"displayName": "Firewall route table Id",
					"strongType": "RouteTable"
				}
			}
		},
		"policyRule": {
			"if": {
				"anyOf": [
					{
						"allOf": [
							{
								"field": "type",
								"equals": "Microsoft.Network/virtualNetworks"
							},
							{
								"not": {
									"field": "Microsoft.Network/virtualNetworks/subnets[*].routeTable.id",
									"equals": "[parameters('rtId')]"
								}
							}
						]
					},
					{
						"allOf": [
							{
								"field": "type",
								"equals": "Microsoft.Network/virtualNetworks/subnets"
							},
							{
								"not": {
									"field": "Microsoft.Network/virtualNetworks/subnets/routeTable.id",
									"equals": "[parameters('rtId')]"
								}
							}
						]
					}
				]
			},
			"then": {
				"effect": "deny"
			}
		}
	}
}
